# 代码审查 Prompt

结构化、全面的代码审查指南。

## 用途

指导 AI 进行系统的代码审查，覆盖正确性、安全性、性能、可维护性等方面。

## 使用场景

- Pull Request 审查
- 代码质量检查
- 重构前评估
- 学习最佳实践

## Prompt 模板

```
请审查以下代码：

## 代码信息
- 语言/框架：{编程语言和框架}
- 功能描述：{代码的功能}
- 上下文：{相关背景信息}

## 代码
\`\`\`{language}
{代码内容}
\`\`\`

请按以下维度进行全面审查：

### 1. 正确性 (Correctness)
- 逻辑是否正确？
- 是否处理所有边界情况？
- 是否有潜在的逻辑错误？
- 算法选择是否合适？

### 2. 安全性 (Security)
- 是否存在安全漏洞？（SQL注入、XSS、CSRF等）
- 输入验证是否充分？
- 敏感信息是否安全处理？
- 权限检查是否完整？

### 3. 性能 (Performance)
- 时间复杂度是否合理？
- 是否存在性能瓶颈？
- 数据库查询是否优化？（避免N+1）
- 是否有不必要的重复计算？

### 4. 可维护性 (Maintainability)
- 代码是否易读易懂？
- 命名是否清晰？
- 函数/类是否单一职责？
- 复杂逻辑是否有注释？

### 5. 最佳实践 (Best Practices)
- 是否遵循语言/框架最佳实践？
- 错误处理是否恰当？
- 是否使用了合适的设计模式？
- 是否符合项目编码规范？

### 6. 测试 (Testing)
- 是否有足够的测试覆盖？
- 测试用例是否全面？
- 是否测试了边界情况？

请按以下格式提供反馈：

## 总体评价
[简短总结]

## 严重问题 (Must Fix)
[必须修复的问题]

## 重要建议 (Should Fix)
[应该解决的问题]

## 改进建议 (Nice to Have)
[可选的改进]

## 优点
[代码做得好的地方]

## 建议代码
[如有具体改进建议，提供代码示例]
```

## 变量说明

- `{编程语言和框架}`: 如"TypeScript + React"
- `{代码的功能}`: 简短描述，如"用户认证中间件"
- `{相关背景信息}`: 项目背景、技术栈等
- `{language}`: 代码语言标识，如"typescript"
- `{代码内容}`: 要审查的代码

## 使用示例

### 示例 1：审查 React 组件

**输入**：
```
请审查以下代码：

## 代码信息
- 语言/框架：TypeScript + React
- 功能描述：用户列表组件，支持分页和搜索
- 上下文：React 18, 使用 Hooks

## 代码
\`\`\`typescript
function UserList() {
  const [users, setUsers] = useState([]);
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState('');
  
  useEffect(() => {
    fetch(`/api/users?page=${page}&search=${search}`)
      .then(res => res.json())
      .then(data => setUsers(data));
  }, [page, search]);
  
  return (
    <div>
      <input 
        value={search} 
        onChange={(e) => setSearch(e.target.value)} 
      />
      <ul>
        {users.map(user => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
      <button onClick={() => setPage(page + 1)}>Next</button>
    </div>
  );
}
\`\`\`

[... 审查维度按模板 ...]
```

**预期输出**：
```
## 总体评价
代码实现了基本功能，但存在几个需要改进的地方...

## 严重问题 (Must Fix)
1. **错误处理缺失**：fetch 没有错误处理，网络失败会导致程序崩溃
2. **搜索防抖缺失**：每次输入都会触发请求，可能导致性能问题

## 重要建议 (Should Fix)
1. **加载状态**：应该添加加载状态显示
2. **空状态处理**：没有数据时应该显示提示
3. **类型定义**：users 应该有明确的类型定义

## 改进建议 (Nice to Have)
1. **提取自定义 Hook**：可以将数据获取逻辑提取为 useUsers hook
2. **分页组件化**：分页逻辑可以独立成组件

## 优点
- 使用了 React Hooks
- 代码结构清晰
- 依赖数组正确

## 建议代码
[提供改进后的代码...]
```

### 示例 2：审查 API 端点

**输入**：
```
请审查以下代码：

## 代码信息
- 语言/框架：Node.js + Express
- 功能描述：用户登录 API
- 上下文：使用 JWT 认证

## 代码
\`\`\`javascript
app.post('/api/login', (req, res) => {
  const { email, password } = req.body;
  const user = db.query(`SELECT * FROM users WHERE email = '${email}'`);
  
  if (user && user.password === password) {
    const token = jwt.sign({ userId: user.id }, 'secret');
    res.json({ token });
  } else {
    res.status(401).json({ error: 'Invalid credentials' });
  }
});
\`\`\`

[... 审查维度按模板 ...]
```

## 变体

### 变体 1：快速审查

```
请快速审查以下代码，重点关注：
- 明显的 bug
- 安全问题
- 性能问题

代码：
[代码]

提供简洁的反馈，优先指出严重问题。
```

### 变体 2：安全审查

```
请从安全角度审查以下代码：

代码：
[代码]

重点检查：
1. 注入攻击（SQL、XSS、Command）
2. 认证和授权问题
3. 敏感数据处理
4. 第三方依赖安全性
5. OWASP Top 10 漏洞

提供详细的安全分析报告。
```

### 变体 3：性能审查

```
请从性能角度审查以下代码：

代码：
[代码]

分析：
1. 时间和空间复杂度
2. 数据库查询效率
3. 缓存机会
4. 并发处理
5. 潜在瓶颈

提供性能优化建议和预期改进效果。
```

### 变体 4：学习审查

```
我是 [经验水平] 开发者，写了以下代码：

[代码]

请：
1. 审查代码
2. 解释问题所在
3. 提供学习建议
4. 推荐相关学习资源

用教学的方式，帮助我理解和改进。
```

## 审查清单

### 通用检查项

**正确性**：
- [ ] 逻辑正确
- [ ] 边界情况处理
- [ ] 错误情况处理
- [ ] 算法选择合理

**安全性**：
- [ ] 输入验证
- [ ] SQL 注入防护
- [ ] XSS 防护
- [ ] CSRF 防护
- [ ] 敏感信息保护

**性能**：
- [ ] 复杂度合理
- [ ] 避免 N+1 查询
- [ ] 合理使用缓存
- [ ] 避免不必要的计算

**可维护性**：
- [ ] 代码可读
- [ ] 命名清晰
- [ ] 适当的注释
- [ ] 单一职责

**测试**：
- [ ] 有单元测试
- [ ] 测试覆盖全面
- [ ] 边界测试
- [ ] 异常测试

### 语言特定检查

**TypeScript/JavaScript**：
- [ ] 类型定义完整
- [ ] 避免 any
- [ ] Promise 错误处理
- [ ] 内存泄漏（事件监听器）

**Python**：
- [ ] 类型提示
- [ ] PEP 8 规范
- [ ] 异常处理
- [ ] 资源管理（with 语句）

**React**：
- [ ] Hooks 规则
- [ ] 依赖数组正确
- [ ] 避免不必要的重渲染
- [ ] Key 属性使用

## 注意事项

1. **保持客观**：基于事实，不做主观判断
2. **建设性反馈**：提供改进建议，不只是指出问题
3. **优先级明确**：区分必须修复和可选改进
4. **提供示例**：对于复杂问题，提供代码示例
5. **认可优点**：指出代码做得好的地方
6. **上下文考虑**：考虑项目阶段和约束条件

## 提示技巧

### 审查整个 PR
```
"审查这个 Pull Request 的所有改动：
[列出文件或提供 diff]"
```

### 审查重构
```
"对比重构前后的代码：

原代码：
[...]

新代码：
[...]

评估重构是否改进了代码质量。"
```

### 审查测试
```
"审查这些测试用例：
[测试代码]

检查：
- 测试覆盖是否充分
- 测试用例是否合理
- 是否测试了边界情况"
```

## 相关资源

- [实现功能 Prompt](implement-feature.md)
- [代码清理 Prompt](../../refactoring/frequently-used/clean-code.md)
- [测试生成 Prompt](test-generation.md)
- [项目编码规范](@.cursor/rules/)

---

**立即使用**: 粘贴代码，让 AI 进行全面审查！
