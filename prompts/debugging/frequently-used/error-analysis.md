# 错误分析 Prompt

系统性地分析和定位错误。

## 用途

指导 AI 系统地分析错误，从现象到根因，再到解决方案。

## 使用场景

- 调试复杂的 bug
- 分析生产环境问题
- 错误根因分析
- 学习调试方法

## Prompt 模板

```
我遇到了一个错误，需要帮助分析和解决：

## 错误信息
\`\`\`
{错误消息、堆栈跟踪}
\`\`\`

## 环境信息
- 环境：{开发/测试/生产}
- 语言/框架：{技术栈}
- 版本信息：{相关版本号}
- 操作系统：{如适用}

## 重现步骤
1. {步骤 1}
2. {步骤 2}
3. {步骤 3}
=> 出现错误

## 相关代码
\`\`\`{language}
{可能相关的代码}
\`\`\`

## 已尝试的方法
- {尝试 1} - {结果}
- {尝试 2} - {结果}

## 预期行为
{描述期望的正确行为}

请按照以下步骤分析：

### 1. 错误解读
- 解释错误消息的含义
- 分析堆栈跟踪
- 识别错误发生的位置

### 2. 可能原因
列出所有可能的原因（从最可能到不太可能）：
1. 原因 1 - 可能性：高/中/低
2. 原因 2 - 可能性：高/中/低
3. ...

### 3. 诊断步骤
提供具体的诊断方法：
- 添加日志/断点的位置
- 需要检查的变量
- 需要验证的假设

### 4. 解决方案
对每个可能原因，提供：
- 验证方法
- 解决代码
- 预防措施

### 5. 根因分析
- 为什么会发生这个错误？
- 如何防止类似错误？
- 是否需要添加测试？
```

## 使用示例

### 示例 1：React 组件错误

**输入**：
```
我遇到了一个错误，需要帮助分析和解决：

## 错误信息
\`\`\`
TypeError: Cannot read property 'name' of undefined
    at UserProfile (UserProfile.tsx:15)
    at renderWithHooks (react-dom.development.js:14985)
\`\`\`

## 环境信息
- 环境：开发
- 语言/框架：React 18 + TypeScript
- 版本信息：React 18.2.0

## 重现步骤
1. 打开用户资料页面
2. URL: /profile/123
3. 页面加载后立即崩溃

## 相关代码
\`\`\`typescript
function UserProfile() {
  const { userId } = useParams();
  const [user, setUser] = useState();
  
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]);
  
  return (
    <div>
      <h1>{user.name}</h1>  // 第 15 行
      <p>{user.email}</p>
    </div>
  );
}
\`\`\`

## 已尝试的方法
- 检查 API 响应 - 数据正常返回
- 添加 console.log - user 初始为 undefined

## 预期行为
应该显示用户姓名和邮箱

[... 后续步骤按模板 ...]
```

## 变体

### 变体 1：生产环境错误

```
生产环境出现错误，需要紧急分析：

错误信息：
[日志/监控数据]

影响范围：
- 用户数量：
- 错误频率：
- 开始时间：

最近的变更：
- 部署时间：
- 变更内容：

请快速提供：
1. 最可能的原因
2. 临时缓解措施
3. 根本解决方案
4. 回滚建议（如需要）
```

### 变体 2：性能问题分析

```
应用响应缓慢，需要性能分析：

症状：
- 响应时间：从 {原来} 增加到 {现在}
- 影响功能：{功能列表}
- 资源使用：CPU/内存/网络

性能数据：
[性能监控数据、火焰图等]

请分析：
1. 性能瓶颈在哪里
2. 为什么变慢了
3. 优化建议
4. 预期改进效果
```

### 变体 3：间歇性错误

```
间歇性出现错误，难以重现：

错误现象：
- 发生频率：{频率}
- 发生规律：{有无规律}
- 错误日志：[日志]

环境因素：
- 负载情况：
- 时间规律：
- 用户特征：

请帮助：
1. 分析可能的竞态条件
2. 提供监控建议
3. 设计重现方法
4. 提出解决方案
```

## 调试技巧

### 1. 缩小范围

```
使用二分法：
1. 注释掉一半代码
2. 看错误是否还存在
3. 根据结果继续缩小范围
4. 直到找到具体位置
```

### 2. 添加日志

```typescript
console.log('1. Before fetch:', { userId });
const user = await fetchUser(userId);
console.log('2. After fetch:', { user });
console.log('3. User name:', { name: user?.name });
```

### 3. 使用调试器

```
1. 在可疑位置设置断点
2. 检查变量值
3. 单步执行
4. 观察调用栈
```

### 4. 隔离问题

```
创建最小重现：
1. 移除无关代码
2. 使用固定测试数据
3. 隔离环境因素
4. 确认可稳定重现
```

## 常见错误模式

### 1. 空值错误
```
原因：访问 null/undefined 的属性
解决：添加空值检查或默认值
```

### 2. 异步时序问题
```
原因：数据未加载完就尝试使用
解决：添加加载状态检查
```

### 3. 状态不同步
```
原因：多处修改状态，导致不一致
解决：使用统一的状态管理
```

### 4. 内存泄漏
```
原因：事件监听器未清理、闭包引用
解决：正确清理资源
```

### 5. 竞态条件
```
原因：多个异步操作顺序不确定
解决：使用锁、取消机制或串行化
```

## 调试清单

### 信息收集
- [ ] 完整的错误消息
- [ ] 堆栈跟踪
- [ ] 重现步骤
- [ ] 环境信息
- [ ] 相关代码
- [ ] 最近的变更

### 分析过程
- [ ] 理解错误消息
- [ ] 定位错误位置
- [ ] 列出可能原因
- [ ] 提出假设
- [ ] 设计验证方法

### 解决验证
- [ ] 实施修复
- [ ] 验证修复效果
- [ ] 测试边界情况
- [ ] 添加防御性代码
- [ ] 编写测试防止回归

## 注意事项

1. **不要猜测**：基于数据和证据，不凭直觉
2. **系统方法**：按步骤分析，不跳跃
3. **记录过程**：记录尝试和结果，避免重复
4. **隔离变量**：一次只改变一个因素
5. **验证假设**：每个假设都要验证
6. **根因分析**：不只修复表面问题，找到根本原因

## 相关资源

- [性能优化 Prompt](performance-optimization.md)
- [代码审查 Prompt](../../coding/frequently-used/code-review.md)
- [测试生成 Prompt](../../coding/frequently-used/test-generation.md)

---

**立即使用**: 粘贴错误信息和相关代码，开始系统性分析！
