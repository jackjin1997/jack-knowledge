# 功能开发工作流

从需求分析到生产部署的完整功能开发流程。

## 适用场景

- 新功能开发
- 功能增强
- 复杂功能实现

## 流程概览

```
需求分析 → 技术设计 → 开发实现 → 代码审查 → 测试 → 部署 → 监控
```

## 详细步骤

### 1. 需求分析

**目标**: 清楚理解要做什么

- [ ] 阅读需求文档/用户故事
- [ ] 明确功能范围
- [ ] 识别关键用户场景
- [ ] 列出边界情况
- [ ] 确认验收标准
- [ ] 评估技术可行性

**输出**: 
- 需求理解文档
- 功能清单
- 疑问列表

**工具**: 
- `@prompts/coding/frequently-used/implement-feature.md`

---

### 2. 技术设计

**目标**: 确定如何实现

- [ ] 设计数据结构/模型
- [ ] 设计 API 接口（如需要）
- [ ] 设计 UI/UX（如需要）
- [ ] 选择技术方案
- [ ] 评估性能影响
- [ ] 识别技术风险
- [ ] 制定实施计划

**输出**:
- 技术设计文档
- API 规范
- 数据库 schema
- 时间估算

**检查点**:
- ✅ 设计方案经过评审
- ✅ 技术风险有应对方案
- ✅ 团队达成共识

---

### 3. 开发环境准备

**目标**: 准备开发环境

- [ ] 创建功能分支
  ```bash
  git checkout -b feature/功能名
  ```
- [ ] 安装必要依赖
- [ ] 配置本地环境
- [ ] 准备测试数据

---

### 4. 实现核心功能

**目标**: 实现主要功能逻辑

- [ ] 按照设计实现代码
- [ ] 遵循编码规范
- [ ] 添加必要注释
- [ ] 处理边界情况
- [ ] 实现错误处理

**最佳实践**:
- 小步提交（每个逻辑块提交一次）
- 提交信息清晰
- 保持代码整洁

**工具**:
- `@prompts/coding/frequently-used/implement-feature.md`
- `@skills/development/frequently-used/create-rule`

---

### 5. 编写测试

**目标**: 确保功能正确性

- [ ] 编写单元测试
- [ ] 编写集成测试
- [ ] 测试正常情况
- [ ] 测试边界情况
- [ ] 测试错误情况
- [ ] 达到目标覆盖率（如 80%）

**工具**:
- `@prompts/coding/frequently-used/test-generation.md`
- `@workflows/testing/frequently-used/unit-testing.md`

---

### 6. 本地测试验证

**目标**: 在本地验证功能

- [ ] 运行所有测试
  ```bash
  npm test
  ```
- [ ] 手动测试功能
- [ ] 检查控制台错误
- [ ] 测试不同浏览器（前端）
- [ ] 验证性能
- [ ] 验证安全性

**检查点**:
- ✅ 所有测试通过
- ✅ 功能符合需求
- ✅ 无明显 bug

---

### 7. 代码审查准备

**目标**: 准备提交审查

- [ ] 运行 linter
  ```bash
  npm run lint
  ```
- [ ] 运行格式化
  ```bash
  npm run format
  ```
- [ ] 自我审查代码
- [ ] 更新文档
- [ ] 提交所有改动
- [ ] 推送到远程
  ```bash
  git push -u origin feature/功能名
  ```

**自我审查清单**:
- [ ] 代码可读性好
- [ ] 命名清晰
- [ ] 无重复代码
- [ ] 无调试代码
- [ ] 无敏感信息

**工具**:
- `@prompts/coding/frequently-used/code-review.md`

---

### 8. 创建 Pull Request

**目标**: 提交代码审查

- [ ] 创建 PR
  ```bash
  # 使用 GitHub CLI
  gh pr create --title "feat: 功能描述" --body "详细说明"
  ```
- [ ] 填写 PR 描述
  - 功能说明
  - 实现方案
  - 测试说明
  - 截图/录屏（如适用）
- [ ] 关联相关 Issue
- [ ] 请求审查者
- [ ] 添加标签

**PR 描述模板**:
```markdown
## 功能说明
[描述这个功能]

## 实现方案
[简述技术方案]

## 测试
- [ ] 单元测试
- [ ] 集成测试
- [ ] 手动测试

## 截图
[如果是 UI 功能，添加截图]

## 检查清单
- [ ] 代码经过自我审查
- [ ] 测试全部通过
- [ ] 文档已更新
```

---

### 9. 代码审查

**目标**: 通过同行审查

- [ ] 回应审查意见
- [ ] 修改代码（如需要）
- [ ] 解释设计决策
- [ ] 推送更新
- [ ] 等待审查通过

**最佳实践**:
- 及时响应审查意见
- 感谢审查者的建议
- 有争议的地方讨论
- 学习审查意见

---

### 10. 合并代码

**目标**: 将代码合并到主分支

- [ ] 确保 CI 通过
- [ ] 解决冲突（如有）
- [ ] 合并 PR
- [ ] 删除功能分支（可选）
  ```bash
  git branch -d feature/功能名
  ```

**合并策略**:
- Squash merge: 多个小提交合并为一个
- Merge commit: 保留所有提交历史
- Rebase merge: 线性历史

---

### 11. 部署到测试环境

**目标**: 在类生产环境测试

- [ ] 部署到 staging
- [ ] 运行 smoke 测试
- [ ] 手动测试核心流程
- [ ] 检查日志和监控
- [ ] 验证性能
- [ ] 验证与其他功能的集成

**检查点**:
- ✅ 功能在 staging 正常工作
- ✅ 无性能问题
- ✅ 无集成问题

---

### 12. 生产部署

**目标**: 安全地部署到生产

- [ ] 参考生产部署检查清单
  `@workflows/deployment/frequently-used/production-deployment.md`
- [ ] 确认部署时间窗口
- [ ] 通知相关方
- [ ] 执行部署
- [ ] 验证部署成功
- [ ] 监控关键指标

---

### 13. 上线后监控

**目标**: 确保功能稳定运行

- [ ] 监控错误率
- [ ] 监控性能指标
- [ ] 监控用户反馈
- [ ] 检查日志异常
- [ ] 验证核心流程
- [ ] 准备回滚方案（如有问题）

**监控周期**: 
- 前 1 小时：密切监控
- 前 24 小时：定期检查
- 第一周：持续关注

---

### 14. 文档更新

**目标**: 保持文档同步

- [ ] 更新 README
- [ ] 更新 API 文档
- [ ] 更新用户文档
- [ ] 更新 CHANGELOG
- [ ] 更新内部文档

**工具**:
- `@prompts/documentation/frequently-used/readme-generation.md`
- `@prompts/documentation/frequently-used/api-docs.md`

---

### 15. 复盘总结

**目标**: 持续改进

- [ ] 记录遇到的问题
- [ ] 记录学到的经验
- [ ] 更新工作流（如需要）
- [ ] 分享给团队

---

## 时间估算

| 阶段 | 小功能 | 中等功能 | 大功能 |
|------|--------|---------|--------|
| 需求分析 | 30min | 2h | 1天 |
| 技术设计 | 1h | 4h | 2天 |
| 开发实现 | 2-4h | 1-2天 | 5天 |
| 测试 | 1h | 4h | 2天 |
| 审查部署 | 1h | 2h | 4h |
| **总计** | **0.5-1天** | **2-3天** | **1-2周** |

## 常见问题

### Q: 需求不清楚怎么办？
A: 立即与产品经理/需求方沟通，不要猜测。

### Q: 技术方案不确定怎么办？
A: 做技术调研，写技术方案文档，找团队讨论。

### Q: 开发中发现需求问题怎么办？
A: 及时与需求方沟通，必要时调整需求或方案。

### Q: 测试失败怎么办？
A: 不要忽略，必须修复后才能继续。

### Q: 代码审查有大量修改意见怎么办？
A: 不要灰心，这是学习机会。认真对待，逐一修改。

## 工具清单

- **需求分析**: `@prompts/coding/frequently-used/implement-feature.md`
- **代码实现**: `@skills/development/frequently-used/create-rule`
- **测试**: `@prompts/coding/frequently-used/test-generation.md`
- **代码审查**: `@prompts/coding/frequently-used/code-review.md`
- **文档**: `@prompts/documentation/`
- **部署**: `@workflows/deployment/frequently-used/production-deployment.md`

## 相关资源

- [Bug 修复工作流](bug-fixing.md)
- [代码重构工作流](code-refactoring.md)
- [单元测试工作流](../../testing/frequently-used/unit-testing.md)
- [生产部署工作流](../../deployment/frequently-used/production-deployment.md)

---

**开始开发**: 按照此流程，确保功能质量和进度！
